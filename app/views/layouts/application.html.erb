<!DOCTYPE html>
<html>
  <head>
    <title>Back My Idea</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <%= stylesheet_link_tag  'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= stylesheet_pack_tag  'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_include_tag 'https://js.stripe.com/v3/' %>
    <%= javascript_pack_tag  'application', 'data-turbolinks-track': 'reload' %>
    <script src="https://js.stripe.com/v3/"></script>
  </head>

 <body class="text-blue-100 bg-blue-800">

  <% flash.each do |type, message| %>
    <% if type == "alert" %>
      <div class="bg-red-500">
        <div class="container px-2 py-4 mx-auto font-sans font-medium text-center text-white"><%= message %></div>
      </div>
    <% end %>
    <% if type == "notice" %>
      <div class="bg-green-500">
        <div class="container px-2 py-4 mx-auto font-sans font-medium text-center text-white"><%= message %></div>
      </div>
    <% end %>
  <% end %>

    <header class="mb-4">
      <nav class="flex flex-wrap items-center justify-between px-3 py-3 text-gray-700 lg:px-10">
        <div class="flex items-center mr-6 flex-no-shrink">
          <%= link_to "Back My Idea", root_path, class:"link text-lg tracking-wider font-semibold uppercase" %>
        </div>
        <div class="block lg:hidden">
          <button class="flex items-center px-3 py-2 text-white border border-gray-500 rounded hover:text-gray-200 hover:border-gray-200">
            <svg class="w-3 h-3 fill-current" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Menu</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"/></svg>
          </button>
        </div>
        <div class="items-center block w-full text-center lg:flex-1 lg:flex lg:text-left">
          <div class="space-x-1 flex flex-row">
            <%= link_to "New Project", new_project_path, class: "btn btn-white mb-2 lg:mb-0" %>

            <%= link_to 'Categories', categories_path , class: "btn btn-white mb-2 lg:mb-0 w-28" %>

            <%##########################################################################################%>

            <%#= form_with(url: "/search", method: "get", local: true) do |form|%>
              <%#= form.label :categories, class: "label" %>
              <%#= form.collection_select :category_ids, Category.order(:name), :id, :name, {}, {class: 'select2 w-full box-border bg-white border-solid border-2 border-gray-600 z-50', multiple: true}%>
              <%#= form.submit %>
            <%# end %>


            <%= form_tag("/categories", method: 'get', class: "category-filter") do %>
              <%#= label_tag(:category_id, "Select a Category") %>
              <%= collection_select(:category, :id, Category.order(:name), :id, :name, options = {include_blank: ""}, html_options = {:onchange => "clickFilterSubmit()"}) %>
              <%= submit_tag("", id: "search_submit")%>
            <% end %>


            <%##########################################################################################%>



          </div>

          <div class="items-center block w-full mt-2 text-center lg:flex lg:flex-row lg:flex-1 lg:mt-0 lg:text-left lg:justify-end">

            <div id= "search-data" class="searchbar">
              <%= form_with(url: "/search", method: "get", local: true) do |form|%>
                <%#= label_tag(:q,"") %>
                <%#= text_field_tag(:q) %>
                <% @titles = Project.pluck(:title)%>
                <%= form.text_field :q, id: "query", placeholder: 'Search', data: {behavior: "autocomplete"} %>
                <!-- <input type="search" placeholder="Search" data-behavior="autocomplete" name="q" id="query"> -->
                <!-- <span class="input-group-btn"> -->
                  <%#= submit_tag "Search", class: 'btn btn-default search-btn' %>
                  <%#= form.submit "Search", class: 'btn btn-default search-btn' %>
                <!-- </span> -->
              <% end %>
            </div>

            <!-- <form class="d-flex">
              <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search" name="q" method="GET" formaction="/search"></input>
              <button class="btn btn-default" type="submit">Search</button>
            </form> -->

            <%= link_to "Shopping Cart", shoppingcart_path, class: "btn btn-white mb-2 lg:mb-0 lg:mr-2 bg-yellow-500 text-white" %>
            <% if user_signed_in? %>
              <%= link_to "Account", edit_user_registration_path, class: "btn btn-default mb-2 lg:mr-2 lg:mb-0 block" %>
              <%= link_to "Log out", destroy_user_session_path, method: :delete, class:"btn btn-default mb-2 lg:mb-0 block" %>
            <% else %>
              <%= link_to "Login", new_user_session_path, class:"btn btn-default mb-2 lg:mr-2 lg:mb-0 block" %>
              <%= link_to "Sign Up", new_user_registration_path, class:"btn btn-default block" %>
            <% end %>
          </div>
        </div>
      </nav>
    </header>

    <main class="px-4 lg:px-10">
      <%= content_for?(:content) ? yield(:content) : yield %>
    </main>
  </body>
</html>


<style type="text/css">
  #query {
    height: 33px;
  }

  .searchbar {
        margin-right: 9px;
    }

  /*#query {
        margin-right: 9px;
    }*/

    .search-btn {
      height: 36px;
    }

    #category_id {
      width: 16px !important;
      height: 35px;
      background-color: white;
      margin-left: -25px !important;
      /*border-radius: 5px;*/

    }

    /*.category-filter{
      margin-left: -32px !important;
    }*/

</style>

<!-- <script type="text/javascript">
  var options = {
    data: JSON.parse("<%#=@titles%>".replace(/&quot;/g,'"'))
    // JSON.parse("[&quot;Project 1&quot;, &quot;Project 2&quot;]".replace(/&quot;/g,'"'))
    // data: ["Project 1", "Project 2", "Project 3", "Project 4", "Project 5", "Project 6"]
  };
  $('*[data-behavior="autocomplete"]').easyAutocomplete(options);
</script> -->

<script type="text/javascript">
  $input = $('*[data-behavior="autocomplete"]')
  var options = {
    // data: JSON.parse("<%#=@titles%>".replace(/&quot;/g,'"'))
    // JSON.parse("[&quot;Project 1&quot;, &quot;Project 2&quot;]".replace(/&quot;/g,'"'))
    // data: ["Project 1", "Project 2", "Project 3", "Project 4", "Project 5", "Project 6"]

      getValue: "title",
      url: function(phrase) {
        return "/search.json?q=" + phrase;
        // return "/search.json?phrase=" + phrase + "&format=json";
      },
      theme: "blue-light",
      list: {
        onChooseEvent: function() {
          var url = "<%=projects_url%>" + "/" + $input.getSelectedItemData().id;
          // var url = "http://localhost:3000/projects/" + $input.getSelectedItemData().id;
          // console.log(url)
          $input.val("");
          Turbolinks.visit(url);
        }
      }
  };
  $input.easyAutocomplete(options);
  // $('*[data-behavior="autocomplete"]').easyAutocomplete(options);

  function clickFilterSubmit() {
    var e = document.getElementById("category_id");
    $("#search_submit").trigger("click");  // only this line is required if we don'tbother about the URL
    // window.location = "http://localhost:3000/categories/" + e.value
    window.location = this.location.origin + "/categories/" + e.value
  }
</script>


<%= javascript_pack_tag "projects.js" %>